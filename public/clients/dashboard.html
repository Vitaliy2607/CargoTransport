<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>–ü–∞–Ω–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞</title>
    <style>
        :root {
            --green-primary: #2e7d32;
            --green-light: #a5d6a7;
            --green-dark: #1b5e20;
            --bg-color: #f9f9f9;
            --text-color: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .header {
            background-color: var(--green-primary);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 22px;
        }

        .user-info {
            /*font-size: 14px;*/
            /*margin-left: auto;*/
            display: flex;F
            align-items: center;
            gap: 12px;
        }

        .tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .tab-btn {
            padding: 14px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #555;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--green-primary);
            border-bottom: 3px solid var(--green-primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            padding: 24px;
            background: white;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h2 {
            margin-bottom: 20px;
            color: var(--green-primary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }

        .btn {
            padding: 10px 20px;
            background-color: var(--green-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn:hover {
            background-color: var(--green-dark);
        }

        .btn-danger {
            background-color: #f44336;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f5f5f5;
        }
        .btn-logout {
            padding: 6px 12px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-logout:hover {
            background-color: #d32f2f;
        }

        .status-created { color: #1976d2; }
        .status-assigned { color: #f57c00; }
        .status-in_transit { color: #388e3c; }
        .status-delivered { color: #388e3c; font-weight: bold; }
        .status-cancelled { color: #d32f2f; text-decoration: line-through; }
    </style>
</head>
<body>
<div class="header">
    <h1>–ü–∞–Ω–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞</h1>
    <div class="user-info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button id="logoutBtn" class="btn-logout">–í—ã–π—Ç–∏</button> <!-- ‚Üê –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ -->
</div>

<div class="tabs">
    <button class="tab-btn active" data-tab="my-orders">–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –≤ –ë–î</button>
    <button class="tab-btn" data-tab="create-order">–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î</button>
    <button class="tab-btn" data-tab="edit-order">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î</button> <!-- ‚Üê –Ω–æ–≤–∞—è -->
    <button class="tab-btn" data-tab="order-details">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</button>
</div>

<!-- –ú–æ–∏ –∑–∞–∫–∞–∑—ã -->
<div id="my-orders" class="tab-content active">
    <h2>–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤ –≤ –ë–î</h2>
    <div style="margin-bottom: 16px;">
        <label>–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:
            <select id="statusFilter">
                <option value="all">–í—Å–µ</option>
                <option value="created">–°–æ–∑–¥–∞–Ω</option>
                <option value="assigned">–ù–∞–∑–Ω–∞—á–µ–Ω</option>
                <option value="in_transit">–í –ø—É—Ç–∏</option>
                <option value="delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</option>
                <option value="cancelled">–û—Ç–º–µ–Ω—ë–Ω</option>
            </select>
        </label>
        <button class="btn" id="refreshOrdersBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <table id="ordersTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
            <th>–î–∞—Ç–∞</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="6">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>
</div>

<!-- –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ -->
<div id="create-order" class="tab-content">
    <h2>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î</h2>
    <form id="createOrderForm">
        <div class="form-group">
            <label for="orderDescription">–û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–∑–∞</label>
            <textarea id="orderDescription" rows="3" required></textarea>
        </div>
        <div class="form-group">
            <label for="orderStart">–ü—É–Ω–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
            <input type="text" id="orderStart" required />
        </div>
        <div class="form-group">
            <label for="orderEnd">–ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
            <input type="text" id="orderEnd" required />
        </div>
        <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
</div>

<!-- –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
<div id="order-details" class="tab-content">
    <h2>–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ <span id="detailOrderId"></span></h2>
    <div id="orderTracker" style="margin: 20px 0; padding: 20px; background: #f9f9f9; border-radius: 8px;">
        <!-- –¢—Ä–µ–∫–µ—Ä –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
    </div>
    <div id="orderDetailContent">
        –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑–∞–º
    </div>
    </div>
    <button class="btn" id="backToOrdersBtn" style="margin-top: 20px;">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–∫–∞–∑–∞–º</button>
</div>
<!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
<div id="edit-order" class="tab-content">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î<span id="editOrderId"></span></h2>
    <form id="editOrderForm">
        <input type="hidden" id="editOrderIdInput" />

        <div class="form-group">
            <label for="editOrderDescription">–û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–∑–∞</label>
            <textarea id="editOrderDescription" rows="3" required></textarea>
        </div>

        <div class="form-group">
            <label for="editOrderStart">–ü—É–Ω–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
            <input type="text" id="editOrderStart" required />
        </div>

        <div class="form-group">
            <label for="editOrderEnd">–ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
            <input type="text" id="editOrderEnd" required />
        </div>

        <div style="display: flex; gap: 12px; margin-top: 20px;">
            <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" id="cancelEditOrderBtn" class="btn" style="background: #ccc;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </form>
</div>
<script>
    window.electronAPI.openDevTools();
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // –î–µ–ª–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–π –Ω–∞–∂–∞—Ç—É—é
                button.classList.add('active');
                const tabId = button.dataset.tab;
                document.getElementById(tabId).classList.add('active');
            });
        });
    });
    let currentClient = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const user = await window.electronAPI.getCurrentUser();
            if (user && user.role === 'client') {
                document.getElementById('userInfo').textContent =
                    `${user.firstName} ${user.lastName} (–∫–ª–∏–µ–Ω—Ç)`;
                currentClient = user;
                console.log("curUser:",currentClient)
                window.electronAPI.setWindowSize(900, 650);
                loadClientOrders();
            } else {
                alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω');
                window.location.href = '../login.html';
            }
        } catch (err) {
            console.error(err);
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
    async function loadClientOrders() {
        const tbody = document.querySelector('#ordersTable tbody');
        const statusFilter = document.getElementById('statusFilter').value;

        try {
            const response = await window.electronAPI.getClientOrders(currentClient.id);
            if (!response.success) {
                tbody.innerHTML = `<tr><td colspan="6">–û—à–∏–±–∫–∞: ${response.message}</td></tr>`;
                return;
            }

            let orders = response.orders;
            if (statusFilter !== 'all') {
                orders = orders.filter(o => o.status === statusFilter);
            }
            orders = orders.map(o => {
                if(o.status === "created"){
                    o.status = '–°–æ–∑–¥–∞–Ω'
                }
                if(o.status === "in_transit"){
                    o.status = '–í –ø—É—Ç–∏'
                }
                if(o.status === "delivered"){
                    o.status = '–î–æ—Å—Ç–∞–≤–ª–µ–Ω'
                }
                if(o.status === "canceled"){
                    o.status = '–û—Ç–º–µ–Ω–µ–Ω'
                }
                return o
            })
            tbody.innerHTML = orders.map(o => `
  <tr data-order-id="${o.orderId}">
    <td>${o.orderId}</td>
    <td>${o.description || '‚Äî'}</td>
    <td><span class="status-${o.status}">${o.status}</span></td>
    <td>${o.price !== null ? Number(o.price).toFixed(2) + ' ‚ÇΩ' : '‚Äî'}</td>
    <td>${new Date(o.createdAt).toLocaleDateString('ru-RU')}</td>
    <td>
  <button class="btn-details">üëÅÔ∏è</button>
  ${o.status === '–°–æ–∑–¥–∞–Ω'
                ? `
      <button class="btn-edit">‚úèÔ∏è</button>
      <button class="btn-cancel">‚ùå</button>
    `
                : ''}
</td>
  </tr>
`).join('');
        } catch (err) {

            console.log(err)
            tbody.innerHTML = '<tr><td colspan="6">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    document.getElementById('refreshOrdersBtn').addEventListener('click', loadClientOrders);
    document.getElementById('statusFilter').addEventListener('change', loadClientOrders);

    // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
    document.getElementById('createOrderForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            clientId: currentClient.id,
            description: document.getElementById('orderDescription').value,
            startPoint: document.getElementById('orderStart').value,
            endPoint: document.getElementById('orderEnd').value
        };
        console.log("data: ",data);
        const res = await window.electronAPI.createOrder(data);
        if (res.success) {
            alert('–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!');
            document.getElementById('createOrderForm').reset();
            // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∑–∞–∫–∞–∑–æ–≤
            document.querySelector('[data-tab="my-orders"]').click();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });

    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    document.getElementById('ordersTable').addEventListener('click', async (e) => {
        const isDetailsBtn = e.target.classList.contains('btn-details');
        const isEditBtn = e.target.classList.contains('btn-edit');
        const isCancelBtn = e.target.classList.contains('btn-cancel');

        if (!isDetailsBtn && !isEditBtn && !isCancelBtn) return;

        const row = e.target.closest('tr');
        if (!row) return;

        const orderIdCell = row.querySelector('td:first-child');
        if (!orderIdCell) return;

        const orderId = orderIdCell.textContent.trim();
        if (!/^\d+$/.test(orderId)) return;

        if (isDetailsBtn) {
            showOrderDetails(orderId);
        }

        if (isEditBtn) {
            openEditOrder(orderId);
        }

        if (isCancelBtn) {
            if (confirm('–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?')) {
                const res = await window.electronAPI.cancelOrder(orderId);
                if (res.success) {
                    alert('–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω');
                    loadClientOrders();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + res.message);
                }
            }
        }
    });
    //row.addEventListener('dblclick', () => showOrderDetails(row.dataset.orderId));

    function renderOrderTracker(order, route, driver, vehicle) {
        const statusConfig = [
            { key: 'created', label: '–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω' },
            { key: 'assigned', label: '–ù–∞–∑–Ω–∞—á–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—å' },
            { key: 'in_transit', label: '–í –ø—É—Ç–∏' },
            { key: 'delivered', label: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω' }
        ];

        const currentIndex = statusConfig.findIndex(s => s.key === order.status);
        if (currentIndex === -1) return; // –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–∫–µ—Ä–∞
        const stepsHtml = statusConfig.map((step, i) => {
            const isCompleted = i < currentIndex;
            const isActive = i === currentIndex;
            const color = isActive ? '#2E7D32' : isCompleted ? '#4CAF50' : '#ccc';
            const textColor = i <= currentIndex ? '#333' : '#999';

            return `
      <div style="text-align: center; flex: 1; min-width: 120px;">
        <div style="
          width: 36px; height: 36px; border-radius: 50%;
          margin: 0 auto 10px;
          background: ${color};
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          font-size: 16px;
        ">${i + 1}</div>
        <div style="font-size: 14px; color: ${textColor};">${step.label}</div>
      </div>
    `;
        }).join('');

        let trackerHtml = `
    <div style="display: flex; justify-content: space-between; position: relative; margin-bottom: 20px;">
      ${stepsHtml}
    </div>
  `;

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è "–≤ –ø—É—Ç–∏"
        if (order.status === 'in_transit' && driver) {
            trackerHtml += `
      <div style="background: #e8f5e9; padding: 16px; border-radius: 8px; margin-top: 16px; border-left: 4px solid #4CAF50;">
        <h4 style="margin-top: 0; color: #2E7D32;">–í–∞—à –≤–æ–¥–∏—Ç–µ–ª—å –Ω–∞ –ª–∏–Ω–∏–∏:</h4>
        <p><strong>${driver.lastName} ${driver.firstName}</strong></p>
        <p>–¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:${driver.phone}" style="color: #2E7D32;">${driver.phone}</a></p>
        ${vehicle ? `<p>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: <strong>${vehicle.brand} ${vehicle.model}</strong> (${vehicle.licensePlate})</p>` : ''}
        ${route?.endDate ? `<p>–û–∂–∏–¥–∞–µ–º–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: <strong>${new Date(route.endDate).toLocaleString('ru-RU')}</strong></p>` : ''}
      </div>
    `;
        }

        document.getElementById('orderTracker').innerHTML = trackerHtml;
    }
    // –ü–æ–∫–∞–∑ –¥–µ—Ç–∞–ª–µ–π
    async function showOrderDetails(orderId) {
        const res = await window.electronAPI.getOrderDetails(orderId);
        if (!res.success) {
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π');
            return;
        }

        const { order, route } = res;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ–¥–∏—Ç–µ–ª—è –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ –º–∞—Ä—à—Ä—É—Ç–µ
        let driver = null;
        let vehicle = null;

        if (route?.driverId) {
            const driverRes = await window.electronAPI.getDriverById(route.driverId);
            if (driverRes.success) driver = driverRes.driver;
        }

        if (route?.vehicleId) {
            const vehicleRes = await window.electronAPI.getVehicleById(route.vehicleId);
            if (vehicleRes.success) vehicle = vehicleRes.vehicle;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        document.getElementById('detailOrderId').textContent = `#${orderId}`;

        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        let routeInfo = "–¢—É–∞–ø—Å–µ -> –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä";
        if (route) {
            routeInfo = `${route.departurePoint} ‚Üí ${route.destinationPoint}`;
        }

        document.getElementById('orderDetailContent').innerHTML = `
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${order.description || '‚Äî'}</p>
    <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${order.price !== null ? Number(order.price).toFixed(2) + ' ‚ÇΩ' : '‚Äî'}</p>
    <p><strong>–ú–∞—Ä—à—Ä—É—Ç:</strong> ${routeInfo}</p>
    <p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> ${new Date(order.createdAt).toLocaleString('ru-RU')}</p>
  `;

        // üî• –û–¢–†–ò–°–û–í–ö–ê –¢–†–ï–ö–ï–†–ê
        renderOrderTracker(order, route, driver, vehicle);

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelector('[data-tab="order-details"]').classList.add('active');
        document.getElementById('order-details').classList.add('active');
    };

    // –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    async function openEditOrder(orderId) {
        const res = await window.electronAPI.getOrderForEdit(orderId);
        if (!res.success) {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
            return;
        }

        const { order, route } = res;

        // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É
        document.getElementById('editOrderId').textContent = `#${orderId}`;
        document.getElementById('editOrderIdInput').value = orderId;
        document.getElementById('editOrderDescription').value = order.description || '';
        document.getElementById('editOrderStart').value = route?.departurePoint || '';
        document.getElementById('editOrderEnd').value = route?.destinationPoint || '';

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelector('[data-tab="edit-order"]').classList.add('active');
        document.getElementById('edit-order').classList.add('active');
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    document.getElementById('editOrderForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const orderId = document.getElementById('editOrderIdInput').value;
        const data = {
            orderId: parseInt(orderId),
            orderData: {
                description: document.getElementById('editOrderDescription').value
            },
            routeData: {
                departurePoint: document.getElementById('editOrderStart').value,
                destinationPoint: document.getElementById('editOrderEnd').value
            }
        };

        // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å routeId –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        // –ù–æ –ø—Ä–æ—â–µ ‚Äî –ø—É—Å—Ç—å –±—ç–∫–µ–Ω–¥ —Å–∞–º —Ä–µ—à–∏—Ç: –æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å

        const res = await window.electronAPI.updateOrder(data);
        if (res.success) {
            alert('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            // –í–µ—Ä–Ω—ë–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤
            document.querySelector('[data-tab="my-orders"]').click();
            loadClientOrders();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });

    // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    document.getElementById('cancelEditOrderBtn').addEventListener('click', () => {
        document.querySelector('[data-tab="my-orders"]').click();
    });
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–í—ã–π—Ç–∏"
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        if (confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
            try {
                await window.electronAPI.logout();
                window.electronAPI.openLoginWindow();
                window.close(); // –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ –∫–ª–∏–µ–Ω—Ç–∞
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            }
        }
    });
</script>
</body>
</html>