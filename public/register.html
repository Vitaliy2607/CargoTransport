<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Регистрация</title>
    <link rel="stylesheet" href="./styles/register.css" />
</head>
<body>
<div class="register-container">
    <h1>Регистрация</h1>
    <form id="registerForm">
        <div class="input-group">
            <label for="firstName">Имя</label>
            <input type="text" id="firstName" name="firstName" required />
        </div>

        <div class="input-group">
            <label for="lastName">Фамилия</label>
            <input type="text" id="lastName" name="lastName" required />
        </div>

        <div class="input-group">
            <label for="patronymic">Отчество</label>
            <input type="text" id="patronymic" name="patronymic" />
        </div>

        <div class="input-group">
            <label for="email">Email (логин)</label>
            <input type="email" id="email" name="email" required />
        </div>

        <div class="input-group">
            <label for="password">Пароль</label>
            <input type="password" id="password" name="password" required minlength="6" />
        </div>

        <div class="input-group">
            <label for="phone">Телефон</label>
            <input type="tel" id="phone" name="phone" required />
        </div>

        <!-- Только для водителя -->
        <div class="input-group driver-only">
            <label for="licenseNumber">Номер водительского удостоверения</label>
            <input type="text" id="licenseNumber" name="licenseNumber" />
        </div>

        <div class="input-group">
            <label for="role">Роль</label>
            <select id="role" name="role" required>
                <option value="" disabled selected>Выберите роль</option>
                <option value="client">Клиент</option>
                <option value="logistician">Логист</option>
                <option value="driver">Водитель</option>
                <option value="admin">Администратор</option>
            </select>
        </div>

        <button type="submit" class="btn-register">Зарегистрироваться</button>
        <button type="button" class="btn-back" id="backToLogin">← Назад к входу</button>
    </form>
</div>

<script>
    // Увеличиваем размер окна при загрузке регистрации
    window.addEventListener('DOMContentLoaded', () => {
        window.electronAPI.setWindowSize(600, 950);
    });
    window.electronAPI.openDevTools();
    // Показ/скрытие поля лицензии для водителя
    document.getElementById('role').addEventListener('change', (e) => {
        const isDriver = e.target.value === 'driver';
        document.querySelector('.driver-only').style.display = isDriver ? 'block' : 'none';
    });

    // Кнопка "назад"
    document.getElementById('backToLogin').addEventListener('click', () => {
        window.location.href = './login.html';
    });

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = {
            firstName: document.getElementById('firstName').value.trim(),
            lastName: document.getElementById('lastName').value.trim(),
            patronymic: document.getElementById('patronymic').value.trim(),
            email: document.getElementById('email').value.trim(),
            password: document.getElementById('password').value,
            phone: document.getElementById('phone').value.trim(),
            licenseNumber: document.getElementById('licenseNumber')?.value.trim(),
            role: document.getElementById('role').value,
        };

        try {
            const response = await window.electronAPI.register(formData);
            if (response.success) {
                alert(response.message);
                // Опционально: сразу перейти в login.html
                window.location.href = './login.html';
            } else {
                alert('Ошибка: ' + response.message);
            }
        } catch (err) {
            console.error(err);
            alert('Произошла техническая ошибка при регистрации');
        }
    });
</script>
</body>
</html>