<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>–ü–∞–Ω–µ–ª—å –ª–æ–≥–∏—Å—Ç–∞</title>
    <style>
        :root {
            --green-primary: #2e7d32;
            --green-light: #a5d6a7;
            --green-dark: #1b5e20;
            --bg-color: #f9f9f9;
            --text-color: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .header {
            background-color: var(--green-primary);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 22px;
        }

        .user-info {
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .tab-btn {
            padding: 14px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #555;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--green-primary);
            border-bottom: 3px solid var(--green-primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            padding: 24px;
            background: white;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h2 {
            margin-bottom: 20px;
            color: var(--green-primary);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º –∏ —Ç–∞–±–ª–∏—Ü */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }

        .btn {
            padding: 10px 20px;
            background-color: var(--green-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn:hover {
            background-color: var(--green-dark);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f5f5f5;
            color: #333;
        }
        .btn-logout {
            padding: 6px 12px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-logout:hover {
            background-color: #d32f2f;
        }
        .btn-edit, .btn-delete {
            padding: 4px 8px;
            margin: 0 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-edit {
            background-color: #4CAF50;
            color: white;
        }

        .btn-edit:hover {
            background-color: #388E3C;
        }

        .btn-delete {
            background-color: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background-color: #d32f2f;
        }
        /* –£–∂–µ –µ—Å—Ç—å .btn-edit –∏ .btn-delete, –Ω–æ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏: */
        .btn-edit-driver, .btn-delete-driver {
            padding: 4px 8px;
            margin: 0 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-edit-driver {
            background-color: #4CAF50;
            color: white;
        }

        .btn-edit-driver:hover {
            background-color: #388E3C;
        }

        .btn-delete-driver {
            background-color: #f44336;
            color: white;
        }

        .btn-delete-driver:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
<div class="header">
    <h1>–ü–∞–Ω–µ–ª—å –ª–æ–≥–∏—Å—Ç–∞</h1>
    <div style="display: flex; align-items: center; gap: 16px;">
        <div class="user-info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button id="logoutBtn" class="btn-logout">–í—ã–π—Ç–∏</button>
    </div>
</div>

<div class="tabs">
    <button class="tab-btn active" data-tab="create-route">–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –≤ –ë–î</button>
    <button class="tab-btn" data-tab="assign-driver">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è –≤ –ë–î</button>
    <button class="tab-btn" data-tab="orders">–ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</button>
    <button class="tab-btn" data-tab="drivers">–ë–î –í–æ–¥–∏—Ç–µ–ª–∏</button>
    <button class="tab-btn" data-tab="routes">–ë–î –ú–∞—Ä—à—Ä—É—Ç—ã</button> <!-- ‚Üê –Ω–æ–≤–∞—è -->
    <button class="tab-btn" data-tab="history">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ä–µ–π—Å–æ–≤</button>
</div>

<!-- –í–∫–ª–∞–¥–∫–∏ -->
<div id="create-route" class="tab-content active">
    <h2>–°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –∑–∞–∫–∞–∑–∞</h2>
    <form id="routeForm">
        <div class="form-group">
            <label for="orderSelect">–ó–∞–∫–∞–∑</label>
            <select id="orderSelect" required>
                <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ ‚Äî</option>
                <!-- –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è JS -->
            </select>
        </div>
        <div class="form-group">
            <label for="departure">–ü—É–Ω–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
            <input type="text" id="departure" required />
        </div>
        <div class="form-group">
            <label for="destination">–ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
            <input type="text" id="destination" required />
        </div>
        <div class="form-group">
            <label for="distance">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)</label>
            <input type="number" id="distance" step="0.01" />
        </div>
        <div class="form-group">
            <label for="startDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
            <input type="datetime-local" id="startDate" />
        </div>
        <div class="form-group">
            <label for="endDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
            <input type="datetime-local" id="endDate" />
        </div>
        <div class="form-group">
            <label for="driverSelect">–í–æ–¥–∏—Ç–µ–ª—å</label>
            <select id="driverSelect">
                <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>
                <!-- –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è JS -->
            </select>
        </div>
        <div class="form-group">
            <label for="vehicleSelect">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</label>
            <select id="vehicleSelect">
                <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>
                <!-- –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è JS -->
            </select>
        </div>
        <button type="submit" class="btn">–°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
    </form>
</div>

<div id="assign-driver" class="tab-content">
    <h2>–ù–∞–∑–Ω–∞—á–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è –Ω–∞ —Ä–µ–π—Å</h2>

    <div class="form-group">
        <label for="assignRouteSelect">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å</label>
        <select id="assignRouteSelect" required>
            <option value="">‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤ ‚Äî</option>
        </select>
    </div>

    <div class="form-group">
        <label for="assignDriverSelect">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è</label>
        <select id="assignDriverSelect" required>
            <option value="">‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–π ‚Äî</option>
        </select>
    </div>

    <button class="btn" id="assignBtn">–ù–∞–∑–Ω–∞—á–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è</button>

    <div id="assignmentResult" style="margin-top: 16px; display: none;"></div>
</div>

<div id="orders" class="tab-content">
    <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
    <table id="ordersTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>–ö–ª–∏–µ–Ω—Ç</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
            <th>–î–∞—Ç–∞</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="5">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>
</div>

<div id="drivers" class="tab-content">
    <h2>–í–æ–¥–∏—Ç–µ–ª–∏</h2>
    <button class="btn" id="refreshDriversBtn" style="margin-bottom: 16px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    <table id="driversTable">
        <thead>
        <tr>
            <th>–§–ò–û</th>
            <th>–õ–∏—Ü–µ–Ω–∑–∏—è</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="6">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>
</div>

<div id="history" class="tab-content">
    <h2>–ò—Å—Ç–æ—Ä–∏—è —Ä–µ–π—Å–æ–≤</h2>
    <button class="btn" id="refreshHistoryBtn" style="margin-bottom: 16px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    <table id="historyTable">
        <thead>
        <tr>
            <th>–†–µ–π—Å ID</th>
            <th>–ó–∞–∫–∞–∑</th>
            <th>–ú–∞—Ä—à—Ä—É—Ç</th>
            <th>–í–æ–¥–∏—Ç–µ–ª—å</th>
            <th>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</th>
            <th>–ü–µ—Ä–∏–æ–¥</th>
            <th>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</th>
            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="8">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>
</div>
<div id="routes" class="tab-content">
    <h2>–í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã</h2>
    <button class="btn" id="refreshRoutesBtn" style="margin-bottom: 16px;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    <table id="routesTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>–ó–∞–∫–∞–∑</th>
            <th>–ú–∞—Ä—à—Ä—É—Ç</th>
            <th>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</th>
            <th>–í–æ–¥–∏—Ç–µ–ª—å</th>
            <th>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</th>
            <th>–ü–µ—Ä–∏–æ–¥</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="8">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ -->
<div id="editRouteModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
    <div style="background:white; margin:50px auto; padding:24px; width:90%; max-width:600px; border-radius:12px;">
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç #<span id="editRouteId"></span></h3>
        <form id="editRouteForm">
            <div class="form-group">
                <label>–ó–∞–∫–∞–∑</label>
                <div id="editOrderDisplay"></div>
            </div>
            <div class="form-group">
                <label for="editDeparture">–ü—É–Ω–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
                <input type="text" id="editDeparture" required />
            </div>
            <div class="form-group">
                <label for="editDestination">–ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</label>
                <input type="text" id="editDestination" required />
            </div>
            <div class="form-group">
                <label for="editDistance">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)</label>
                <input type="number" id="editDistance" step="0.01" />
            </div>
            <div class="form-group">
                <label for="editStartDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                <input type="datetime-local" id="editStartDate" />
            </div>
            <div class="form-group">
                <label for="editEndDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                <input type="datetime-local" id="editEndDate" />
            </div>
            <div class="form-group">
                <label for="editDriverSelect">–í–æ–¥–∏—Ç–µ–ª—å</label>
                <select id="editDriverSelect">
                    <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>
                    <!-- –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è -->
                </select>
            </div>
            <div class="form-group">
                <label for="editVehicleSelect">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</label>
                <select id="editVehicleSelect">
                    <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>
                    <!-- –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è -->
                </select>
            </div>
            <div style="display:flex; gap:12px; margin-top:20px;">
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="cancelEditBtn" class="btn" style="background:#ccc;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>
<script>
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –≥–ª–∞–≤–Ω–æ–≥–æ –æ–∫–Ω–∞ –ª–æ–≥–∏—Å—Ç–∞
    window.electronAPI.setWindowSize(1000, 720);
    //window.electronAPI.openDevTools();
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll('.tab-btn').forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.dataset.tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∏–∑ Electron)
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const user = await window.electronAPI.getCurrentUser();
            if (user && user.role === 'logistician') {
                document.getElementById('userInfo').textContent =
                    `${user.firstName} ${user.lastName} (–ª–æ–≥–∏—Å—Ç)`;
            } else {
                alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω');
                window.location.href = '../login.html';
            }
        } catch (err) {
            console.error(err);
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        }
        async function loadActiveOrders() {
            try {
                const response = await window.electronAPI.getActiveOrders();
                const tbody = document.querySelector('#ordersTable tbody');
                if (response.success) {
                    const orders = response.orders;
                    if (orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</td></tr>';
                        return;
                    }

                    tbody.innerHTML = orders.map(order => `
          <tr>
            <td>${order.orderId}</td>
            <td>${order.lastName} ${order.firstName}</td>
            <td>${order.description || '‚Äî'}</td>
            <td>${order.status}</td>
            <td>${order.price !== null ? Number(order.price).toFixed(2) + ' ‚ÇΩ' : '‚Äî'}</td>
            <td>${new Date(order.createdAt).toLocaleString('ru-RU')}</td>
          </tr>
        `).join('');
                } else {
                    tbody.innerHTML = `<tr><td colspan="5">–û—à–∏–±–∫–∞: ${response.message}</td></tr>`;
                }
            } catch (err) {
                console.error(err);
                document.querySelector('#ordersTable tbody').innerHTML =
                    '<tr><td colspan="5">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
            }
        }
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ "–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã"
        document.querySelector('[data-tab="orders"]').addEventListener('click', loadActiveOrders);

        // –¢–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏, –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
        window.addEventListener('DOMContentLoaded', () => {
            // ... (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

            // –ü—Ä–æ–≤–µ—Ä–∏–º: –µ—Å–ª–∏ —Å–µ–π—á–∞—Å –æ—Ç–∫—Ä—ã—Ç–∞ –≤–∫–ª–∞–¥–∫–∞ orders ‚Äî –∑–∞–≥—Ä—É–∑–∏–º
            if (document.getElementById('orders').classList.contains('active')) {
                loadActiveOrders();
            }
        });
    });

    //----------crud routes
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤, –≤–æ–¥–∏—Ç–µ–ª–µ–π, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
    async function loadRouteDependencies() {
        try {
            // –ó–∞–∫–∞–∑—ã (–∞–∫—Ç–∏–≤–Ω—ã–µ)
            const ordersRes = await window.electronAPI.getActiveOrders();
            const orderSelect = document.getElementById('orderSelect');
            orderSelect.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ ‚Äî</option>';
            if (ordersRes.success) {
                ordersRes.orders.forEach(order => {
                    const opt = document.createElement('option');
                    opt.value = order.orderId;
                    opt.textContent = `#${order.orderId} ‚Äî ${order.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}`;
                    orderSelect.appendChild(opt);
                });
            }

            // –í–æ–¥–∏—Ç–µ–ª–∏
            const driversRes = await window.electronAPI.getDrivers(); // ‚Üê –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
            const driverSelect = document.getElementById('driverSelect');
            driverSelect.innerHTML = '<option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>';
            if (driversRes && driversRes.success) {
                driversRes.drivers.forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d.id;
                    opt.textContent = `${d.lastName} ${d.firstName} (${d.phone})`;
                    driverSelect.appendChild(opt);
                });
            }

            // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            const vehiclesRes = await window.electronAPI.getVehicles(); // ‚Üê –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
            const vehicleSelect = document.getElementById('vehicleSelect');
            vehicleSelect.innerHTML = '<option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>';
            if (vehiclesRes && vehiclesRes.success) {
                vehiclesRes.vehicles.forEach(v => {
                    const opt = document.createElement('option');
                    opt.value = v.id;
                    opt.textContent = `${v.brand} ${v.model} (${v.licensePlate})`;
                    vehicleSelect.appendChild(opt);
                });
            }
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–∞—Ä—à—Ä—É—Ç–∞:', err);
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞
    document.getElementById('routeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            orderId: parseInt(document.getElementById('orderSelect').value),
            departurePoint: document.getElementById('departure').value,
            destinationPoint: document.getElementById('destination').value,
            distance: parseFloat(document.getElementById('distance').value) || null,
            startDate: document.getElementById('startDate').value ? new Date(document.getElementById('startDate').value) : null,
            endDate: document.getElementById('endDate').value ? new Date(document.getElementById('endDate').value) : null,
            driverId: document.getElementById('driverSelect').value ? parseInt(document.getElementById('driverSelect').value) : null,
            vehicleId: document.getElementById('vehicleSelect').value ? parseInt(document.getElementById('vehicleSelect').value) : null,
        };

        const res = await window.electronAPI.createRoute(data);
        if (res.success) {
            alert('–ú–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω!');
            document.getElementById('routeForm').reset();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });
    //---------------------------------------------------

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('[data-tab="create-route"]').addEventListener('click', loadRouteDependencies);
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        if (confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
            try {
                await window.electronAPI.logout();
                window.electronAPI.openLoginWindow(); // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –ª–æ–≥–∏–Ω–∞
                window.close(); // –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –æ–∫–Ω–æ
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:', err);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            }
        }
    });
    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
    async function loadAllRoutes() {
        const tbody = document.querySelector('#routesTable tbody');
        try {
            const response = await window.electronAPI.getAllRoutes();
            if (!response.success) {
                tbody.innerHTML = `<tr><td colspan="8">–û—à–∏–±–∫–∞: ${response.message}</td></tr>`;
                return;
            }

            const routes = response.routes;
            if (routes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8">–ù–µ—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤</td></tr>';
                return;
            }

            tbody.innerHTML = routes.map(route => {
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
                const start = route.startDate ? new Date(route.startDate).toLocaleString('ru-RU') : '‚Äî';
                const end = route.endDate ? new Date(route.endDate).toLocaleString('ru-RU') : '‚Äî';

                // –°—Ç–∞—Ç—É—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç
                let status = '–ù–µ –∑–∞–¥–∞–Ω';
                if (route.startDate && route.endDate) {
                    const now = new Date();
                    const startD = new Date(route.startDate);
                    const endD = new Date(route.endDate);
                    if (now < startD) status = '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω';
                    else if (now >= startD && now <= endD) status = '–í –ø—É—Ç–∏';
                    else if (now > endD) status = '–ó–∞–≤–µ—Ä—à—ë–Ω';
                } else if (route.startDate) {
                    const now = new Date();
                    if (now < new Date(route.startDate)) status = '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω';
                    else status = '–í –ø—É—Ç–∏';
                }

                // –í–æ–¥–∏—Ç–µ–ª—å
                const driver = route.driverId
                    ? `${route.driverLastName || ''} ${route.driverFirstName || ''}`.trim() || '‚Äî'
                    : '‚Äî';

                // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
                const vehicle = route.vehicleId
                    ? `${route.vehicleBrand || ''} ${route.vehicleModel || ''} (${route.vehicleLicensePlate || ''})`.trim() || '‚Äî'
                    : '‚Äî';

                // –ó–∞–∫–∞–∑
                const orderDesc = route.orderDescription || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è';
                const orderInfo = `#${route.orderId} ‚Äî ${orderDesc}`;

                return `
                  <tr>
                    <td>${route.routeId}</td>
                    <td>${orderInfo}</td>
                    <td>${route.departurePoint} ‚Üí ${route.destinationPoint}</td>
                    <td>${route.distance !== null ? route.distance + ' –∫–º' : '‚Äî'}</td>
                    <td>${driver}</td>
                    <td>${vehicle}</td>
                    <td>${start} ‚Äî ${end}</td>
                    <td>${status}</td>
                    <td>
                      <button class="btn-edit" data-id="${route.routeId}">‚úèÔ∏è</button>
                      <button class="btn-delete" data-id="${route.routeId}">üóëÔ∏è</button>
                    </td>
                  </tr>
                `;
            }).join('');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤:', err);
            tbody.innerHTML = '<tr><td colspan="8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
        }
    }

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
    let currentRouteForEdit = null;

    // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    async function openEditModal(routeId) {
        const route = await window.electronAPI.getRouteById(routeId); // ‚Üê –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
        if (!route.success) {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç');
            return;
        }
        currentRouteForEdit = route.route;

        // –ó–∞–ø–æ–ª–Ω–∏–º —Ñ–æ—Ä–º—É
        document.getElementById('editRouteId').textContent = routeId;
        document.getElementById('editOrderDisplay').textContent = `#${route.route.orderId} ‚Äî ${route.route.orderDescription || '‚Äî'}`;
        document.getElementById('editDeparture').value = route.route.departurePoint;
        document.getElementById('editDestination').value = route.route.destinationPoint;
        document.getElementById('editDistance').value = route.route.distance || '';
        document.getElementById('editStartDate').value = route.route.startDate
            ? new Date(route.route.startDate).toISOString().slice(0, 16) : '';
        document.getElementById('editEndDate').value = route.route.endDate
            ? new Date(route.route.endDate).toISOString().slice(0, 16) : '';

        // –ó–∞–≥—Ä—É–∑–∏–º –≤–æ–¥–∏—Ç–µ–ª–µ–π –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤
        const driversRes = await window.electronAPI.getDrivers();
        const driverSelect = document.getElementById('editDriverSelect');
        driverSelect.innerHTML = '<option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>';
        if (driversRes.success) {
            driversRes.drivers.forEach(d => {
                const opt = document.createElement('option');
                opt.value = d.id;
                opt.textContent = `${d.lastName} ${d.firstName} [${d.licenseNumber}] ${d.isWorking ? '' : '(–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)'}`;
                opt.disabled = !d.isWorking;
                if (d.id === route.route.driverId) opt.selected = true;
                driverSelect.appendChild(opt);
            });
        }

        const vehiclesRes = await window.electronAPI.getVehicles();
        const vehicleSelect = document.getElementById('editVehicleSelect');
        vehicleSelect.innerHTML = '<option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω ‚Äî</option>';
        if (vehiclesRes.success) {
            vehiclesRes.vehicles.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v.id;
                opt.textContent = `${v.brand} ${v.model} (${v.licensePlate}) ${v.isWorking ? '' : '(–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)'}`;
                opt.disabled = !v.isWorking;
                if (v.id === route.route.vehicleId) opt.selected = true;
                vehicleSelect.appendChild(opt);
            });
        }

        document.getElementById('editRouteModal').style.display = 'block';
    }
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å)
    async function loadRoutesForAssignment() {
        const select = document.getElementById('assignRouteSelect');
        select.innerHTML = '<option value="">‚Äî –ó–∞–≥—Ä—É–∑–∫–∞... ‚Äî</option>';

        try {
            const response = await window.electronAPI.getAllRoutes();
            if (!response.success) throw new Error(response.message);

            // –§–∏–ª—å—Ç—Ä—É–µ–º: —Ç–æ–ª—å–∫–æ —Ä–µ–π—Å—ã –±–µ–∑ –≤–æ–¥–∏—Ç–µ–ª—è –ò–õ–ò –≤—Å–µ (–Ω–∞ –≤—ã–±–æ—Ä)
            const routes = response.routes

            select.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å ‚Äî</option>';
            routes.forEach(route => {
                const opt = document.createElement('option');
                opt.value = route.routeId;
                const orderDesc = route.orderDescription || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è';
                opt.textContent = `–†–µ–π—Å #${route.routeId} | –ó–∞–∫–∞–∑ #${route.orderId} ‚Äî ${orderDesc} | ${route.departurePoint} ‚Üí ${route.destinationPoint}`;
                select.appendChild(opt);
            });
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Å–æ–≤:', err);
            select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö)
    async function loadDriversForAssignment() {
        const select = document.getElementById('assignDriverSelect');
        select.innerHTML = '<option value="">‚Äî –ó–∞–≥—Ä—É–∑–∫–∞... ‚Äî</option>';

        try {
            const response = await window.electronAPI.getDrivers();
            if (!response.success) throw new Error(response.message);

            select.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è ‚Äî</option>';
            response.drivers
                .filter(d => d.isWorking) // —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ
                .forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d.id;
                    opt.textContent = `${d.lastName} ${d.firstName} (${d.licenseNumber})`;
                    select.appendChild(opt);
                });
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π:', err);
            select.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
        }
    }
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≤–æ–¥–∏—Ç–µ–ª–µ–π
    async function loadDriversList() {
        const tbody = document.querySelector('#driversTable tbody');
        try {
            const response = await window.electronAPI.getDrivers();
            if (!response.success) {
                tbody.innerHTML = `<tr><td colspan="6">–û—à–∏–±–∫–∞: ${response.message}</td></tr>`;
                return;
            }

            const drivers = response.drivers;
            if (drivers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">–ù–µ—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–π</td></tr>';
                return;
            }

            tbody.innerHTML = drivers.map(d => `
      <tr>
        <td>${d.lastName} ${d.firstName} ${d.patronymic || ''}</td>
        <td>${d.licenseNumber}</td>
        <td>${d.phone}</td>
        <td>
          <span style="color: ${d.isWorking ? 'green' : 'red'};">
            ${d.isWorking ? '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç'}
          </span>
        </td>
        <td>${new Date(d.createdAt).toLocaleDateString('ru-RU')}</td>
        <td>
          <button class="btn-edit-driver" data-id="${d.id}">‚úèÔ∏è</button>
          <button class="btn-delete-driver" data-id="${d.id}">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π:', err);
            tbody.innerHTML = '<tr><td colspan="6">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
        }
    }
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–µ–π—Å–æ–≤ (–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö)
    async function loadHistory() {
        const tbody = document.querySelector('#historyTable tbody');
        try {
            const response = await window.electronAPI.getHistoryRoutes();
            console.log("response: ",response);
            if (!response.success) {
                tbody.innerHTML = `<tr><td colspan="8">–û—à–∏–±–∫–∞: ${response.message}</td></tr>`;
                return;
            }

            const routes = response.routes;
            if (routes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8">–ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ä–µ–π—Å–æ–≤</td></tr>';
                return;
            }

            tbody.innerHTML = routes.map(route => {
                const start = route.startDate ? new Date(route.startDate).toLocaleString('ru-RU') : '‚Äî';
                const end = route.endDate ? new Date(route.endDate).toLocaleString('ru-RU') : '‚Äî';

                const driver = route.driverId
                    ? `${route.driverLastName || ''} ${route.driverFirstName || ''}`.trim() || '‚Äî'
                    : '‚Äî';

                const vehicle = route.vehicleId
                    ? `${route.vehicleBrand || ''} ${route.vehicleModel || ''} (${route.vehicleLicensePlate || ''})`.trim() || '‚Äî'
                    : '‚Äî';

                const orderDesc = route.orderDescription || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è';
                const orderInfo = `#${route.orderId} ‚Äî ${orderDesc}`;

                return `
        <tr>
          <td>${route.routeId}</td>
          <td>${orderInfo}</td>
          <td>${route.departurePoint} ‚Üí ${route.destinationPoint}</td>
          <td>${driver}</td>
          <td>${vehicle}</td>
          <td>${start} ‚Äî ${end}</td>
          <td>${route.distance !== null ? route.distance + ' –∫–º' : '‚Äî'}</td>
          <td>${route.orderPrice !== null ? route.orderPrice.toFixed(2) + ' ‚ÇΩ' : '‚Äî'}</td>
        </tr>
      `;
            }).join('');
        } catch (err) {
            console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', err);
            tbody.innerHTML = '<tr><td colspan="8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –∫–Ω–æ–ø–∫–µ
    document.getElementById('refreshDriversBtn').addEventListener('click', loadDriversList);

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('[data-tab="drivers"]').addEventListener('click', loadDriversList);
    // –ù–∞–∑–Ω–∞—á–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è
    document.getElementById('assignBtn').addEventListener('click', async () => {
        const routeId = document.getElementById('assignRouteSelect').value;
        const driverId = document.getElementById('assignDriverSelect').value;
        const resultDiv = document.getElementById('assignmentResult');

        if (!routeId || !driverId) {
            resultDiv.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å –∏ –≤–æ–¥–∏—Ç–µ–ª—è';
            resultDiv.style.color = 'red';
            resultDiv.style.display = 'block';
            return;
        }

        try {
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º driverId
            const updateData = { driverId: parseInt(driverId) };
            const res = await window.electronAPI.updateRoute(parseInt(routeId), updateData);

            if (res.success) {
                resultDiv.textContent = '‚úÖ –í–æ–¥–∏—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω!';
                resultDiv.style.color = 'green';

                // –û—á–∏—Å—Ç–∏–º —Ñ–æ—Ä–º—É
                document.getElementById('assignRouteSelect').value = '';
                document.getElementById('assignDriverSelect').value = '';

                // –û–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫ —Ä–µ–π—Å–æ–≤ (—á—Ç–æ–±—ã –∏—Å—á–µ–∑ –∏–∑ —Å–ø–∏—Å–∫–∞)
                loadRoutesForAssignment();
            } else {
                resultDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + res.message;
                resultDiv.style.color = 'red';
            }
            resultDiv.style.display = 'block';
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:', err);
            resultDiv.textContent = '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
            resultDiv.style.color = 'red';
            resultDiv.style.display = 'block';
        }
    });
    // –ü—Ä–∏–≤—è–∂–µ–º –∫ –≤–∫–ª–∞–¥–∫–µ
    document.querySelector('[data-tab="assign-driver"]').addEventListener('click', () => {
        loadRoutesForAssignment();
        loadDriversForAssignment();
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    document.getElementById('editRouteForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentRouteForEdit) return;

        const data = {
            departurePoint: document.getElementById('editDeparture').value,
            destinationPoint: document.getElementById('editDestination').value,
            distance: parseFloat(document.getElementById('editDistance').value) || null,
            startDate: document.getElementById('editStartDate').value
                ? new Date(document.getElementById('editStartDate').value) : null,
            endDate: document.getElementById('editEndDate').value
                ? new Date(document.getElementById('editEndDate').value) : null,
            driverId: document.getElementById('editDriverSelect').value
                ? parseInt(document.getElementById('editDriverSelect').value) : null,
            vehicleId: document.getElementById('editVehicleSelect').value
                ? parseInt(document.getElementById('editVehicleSelect').value) : null,
        };

        const res = await window.electronAPI.updateRoute(currentRouteForEdit.routeId, data);
        if (res.success) {
            alert('–ú–∞—Ä—à—Ä—É—Ç –æ–±–Ω–æ–≤–ª—ë–Ω!');
            document.getElementById('editRouteModal').style.display = 'none';
            loadAllRoutes(); // –æ–±–Ω–æ–≤–∏–º —Ç–∞–±–ª–∏—Ü—É
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });

    // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    document.getElementById('cancelEditBtn').addEventListener('click', () => {
        document.getElementById('editRouteModal').style.display = 'none';
    });
    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ
    document.getElementById('routesTable').addEventListener('click', async (e) => {
        if (e.target.classList.contains('btn-delete')) {
            const routeId = e.target.dataset.id;
            if (confirm('–£–¥–∞–ª–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç #' + routeId + '?')) {
                const res = await window.electronAPI.deleteRoute(routeId);
                if (res.success) {
                    alert('–ú–∞—Ä—à—Ä—É—Ç —É–¥–∞–ª—ë–Ω');
                    loadAllRoutes();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + res.message);
                }
            }
        }

        if (e.target.classList.contains('btn-edit')) {
            const routeId = e.target.dataset.id;
            openEditModal(routeId);
        }
    });
    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–æ–¥–∏—Ç–µ–ª–µ–π
    document.getElementById('driversTable').addEventListener('click', async (e) => {
        const id = e.target.dataset.id;

        if (e.target.classList.contains('btn-edit-driver')) {
            alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ');
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        }

        if (e.target.classList.contains('btn-delete-driver')) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤–æ–¥–∏—Ç–µ–ª—è? –≠—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–π—Å—ã!')) {
                const res = await window.electronAPI.deleteDriver(id);
                if (res.success) {
                    alert('–í–æ–¥–∏—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω');
                    loadDriversList();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + res.message);
                }
            }
        }
    });

    // –ü—Ä–∏–≤—è–∂–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫ –∫–Ω–æ–ø–∫–µ –∏ –≤–∫–ª–∞–¥–∫–µ
    document.getElementById('refreshRoutesBtn').addEventListener('click', loadAllRoutes);
    document.querySelector('[data-tab="routes"]').addEventListener('click', loadAllRoutes);

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –∫–Ω–æ–ø–∫–µ
    document.getElementById('refreshHistoryBtn').addEventListener('click', loadHistory);

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('[data-tab="history"]').addEventListener('click', loadHistory);
</script>
</body>
</html>