<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>–ü–∞–Ω–µ–ª—å –≤–æ–¥–∏—Ç–µ–ª—è</title>
    <style>
        :root {
            --green-primary: #2e7d32;
            --green-light: #a5d6a7;
            --green-dark: #1b5e20;
            --bg-color: #f9f9f9;
            --text-color: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .header {
            background-color: var(--green-primary);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 22px;
        }

        .user-info {
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .tab-btn {
            padding: 14px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #555;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--green-primary);
            border-bottom: 3px solid var(--green-primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            padding: 24px;
            background: white;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h2 {
            margin-bottom: 20px;
            color: var(--green-primary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }

        .btn {
            padding: 10px 20px;
            background-color: var(--green-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn:hover {
            background-color: var(--green-dark);
        }

        .btn-danger {
            padding: 6px 12px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-danger:hover {
            padding: 6px 12px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f5f5f5;
        }

        .btn-edit-route, .btn-delete-route {
            padding: 4px 8px;
            margin: 0 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-edit-route {
            background-color: #4CAF50;
            color: white;
        }

        .btn-edit-route:hover {
            background-color: #388E3C;
        }

        .btn-delete-route {
            background-color: #f44336;
            color: white;
        }

        .btn-delete-route:hover {
            background-color: #d32f2f;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        #routeModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        #routeModal > div {
            background: white;
            margin: 50px auto;
            padding: 24px;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
        }
        .custom-radio-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
        }

        .custom-radio-label input[type="radio"] {
            opacity: 0;
            position: absolute;
            width: 0;
            height: 0;
            margin: 0;
            padding: 0;
        }

        .custom-radio {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ccc;
            border-radius: 50%;
            position: relative;
            background: white;
            transition: all 0.2s;
        }

        .custom-radio-label:hover .custom-radio {
            border-color: #999;
        }

        .custom-radio-label input[type="radio"]:checked + .custom-radio {
            background: #7c4dff;
            border-color: #7c4dff;
        }

        .custom-radio-label input[type="radio"]:checked + .custom-radio::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

    </style>
</head>
<body>
<div class="header">
    <h1>–ü–∞–Ω–µ–ª—å –≤–æ–¥–∏—Ç–µ–ª—è</h1>
    <div style="display: flex; align-items: center; gap: 16px;">
        <div class="user-info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button id="logoutBtn" class="btn-danger">–í—ã–π—Ç–∏</button>
    </div>
</div>

<div class="tabs">
    <button class="tab-btn active" data-tab="my-routes">–ë–î –†–µ–π—Å—ã –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª—è</button>
    <button class="tab-btn" data-tab="violations">–ë–î –ù–∞—Ä—É—à–µ–Ω–∏—è</button> <!-- ‚Üê –Ω–æ–≤–∞—è -->
    <button class="tab-btn" data-tab="fuel">–ë–î –ó–∞–ø—Ä–∞–≤–∫–∏</button> <!-- ‚Üê –Ω–æ–≤–∞—è -->
    <button class="tab-btn" data-tab="vehicles">–ë–î –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button> <!-- ‚Üê –Ω–æ–≤–∞—è -->
</div>

<!-- –í–∫–ª–∞–¥–∫–∞: –ú–æ–∏ —Ä–µ–π—Å—ã -->
<div id="my-routes" class="tab-content active">
    <button class="btn" id="addRouteBtn" style="margin-bottom: 16px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–π—Å</button>

    <table id="routesTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>–ó–∞–∫–∞–∑</th>
            <th>–ú–∞—Ä—à—Ä—É—Ç</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–∞—Ç—ã</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="6">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—Å–æ–∑–¥–∞–Ω–∏—è -->
<div id="routeModal">
    <div>
        <h3 id="routeModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–π—Å</h3>
        <form id="routeForm">
            <input type="hidden" id="routeId" />

            <div class="form-group">
                <label for="routeOrder">–ó–∞–∫–∞–∑ (ID) *</label>
                <input type="number" id="routeOrder" required />
            </div>

            <div class="form-group">
                <label for="routeStart">–ü—É–Ω–∫—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è *</label>
                <input type="text" id="routeStart" required />
            </div>

            <div class="form-group">
                <label for="routeEnd">–ü—É–Ω–∫—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è *</label>
                <input type="text" id="routeEnd" required />
            </div>

            <div class="form-group">
                <label for="routeStartDateTime">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                <input type="datetime-local" id="routeStartDateTime" />
            </div>

            <div class="form-group">
                <label for="routeEndDateTime">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                <input type="datetime-local" id="routeEndDateTime" />
            </div>

            <div class="form-group">
                <label for="routeDistance">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)</label>
                <input type="number" id="routeDistance" step="0.01" />
            </div>

            <div style="display:flex; gap:12px; margin-top:20px;">
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" id="cancelRouteBtn" class="btn" style="background:#ccc;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>
<!-- –í–∫–ª–∞–¥–∫–∞: –ù–∞—Ä—É—à–µ–Ω–∏—è -->
<div id="violations" class="tab-content">
    <h2>–ù–∞—Ä—É—à–µ–Ω–∏—è</h2>
    <button class="btn" id="addViolationBtn" style="margin-bottom: 16px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</button>

    <table id="violationsTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>–†–µ–π—Å</th>
            <th>–¢–∏–ø</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–°—É–º–º–∞</th>
            <th>–î–∞—Ç–∞</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="7">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="violationModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
        <div style="background:white; margin:50px auto; padding:24px; width:90%; max-width:600px; border-radius:12px;">
            <h3 id="violationModalTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ</h3>
            <form id="violationForm">
                <input type="hidden" id="violationId" />

                <div class="form-group">
                    <label for="violationRoute">–†–µ–π—Å *</label>
                    <select id="violationRoute" required>
                        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å ‚Äî</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–¢–∏–ø *</label>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="custom-radio-label">
                            <span>–î–¢–ü</span>
                            <input type="radio" id="violationTypeAccident" name="violationType" value="accident" required>
                            <span class="custom-radio"></span>
                        </label>
                        <label class="custom-radio-label">
                            <span>–®—Ç—Ä–∞—Ñ</span>
                            <input type="radio" id="violationTypeFine" name="violationType" value="fine" required>
                            <span class="custom-radio"></span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="violationDesc">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="violationDesc" rows="3"></textarea>
                </div>

                <div class="form-group" id="violationAmountGroup" style="display: none;">
                    <label for="violationAmount">–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–∞ (‚ÇΩ)</label>
                    <input type="number" id="violationAmount" step="0.01" placeholder="0.00" />
                </div>

                <div class="form-group">
                    <label for="violationDate">–î–∞—Ç–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è</label>
                    <input type="datetime-local" id="violationDate" />
                </div>

                <div style="display:flex; gap:12px; margin-top:20px;">
                    <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" id="cancelViolationBtn" class="btn" style="background:#ccc;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- –í–∫–ª–∞–¥–∫–∞: –ó–∞–ø—Ä–∞–≤–∫–∏ -->
<div id="fuel" class="tab-content">
    <h2>–ó–∞–ø—Ä–∞–≤–∫–∏</h2>
    <button class="btn" id="addFuelBtn" style="margin-bottom: 16px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É</button>

    <table id="fuelTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>–†–µ–π—Å</th>
            <th>–¢–∏–ø</th>
            <th>–û–±—ä—ë–º (–ª)</th>
            <th>–¶–µ–Ω–∞ –∑–∞ –ª</th>
            <th>–ò—Ç–æ–≥–æ</th>
            <th>–î–∞—Ç–∞</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="8">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="fuelModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
        <div style="background:white; margin:50px auto; padding:24px; width:90%; max-width:600px; border-radius:12px;">
            <h3 id="fuelModalTitle">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É</h3>
            <form id="fuelForm">
                <input type="hidden" id="fuelId" />

                <div class="form-group">
                    <label for="fuelRoute">–†–µ–π—Å *</label>
                    <select id="fuelRoute" required>
                        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å ‚Äî</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fuelType">–¢–∏–ø —Ç–æ–ø–ª–∏–≤–∞ *</label>
                    <select id="fuelType" required>
                        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
                        <option value="–î–¢">–î–∏–∑–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ (–î–¢)</option>
                        <option value="–ê–ò-95">–ë–µ–Ω–∑–∏–Ω –ê–ò-95</option>
                        <option value="–ê–ò-92">–ë–µ–Ω–∑–∏–Ω –ê–ò-92</option>
                        <option value="–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fuelVolume">–û–±—ä—ë–º (–ª –∏–ª–∏ –∫–í—Ç¬∑—á) *</label>
                    <input type="number" id="fuelVolume" step="0.01" required />
                </div>

                <div class="form-group">
                    <label for="fuelPrice">–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (‚ÇΩ) *</label>
                    <input type="number" id="fuelPrice" step="0.01" required />
                </div>

                <div class="form-group">
                    <label for="fuelTotal">–ò—Ç–æ–≥–æ (‚ÇΩ)</label>
                    <input type="number" id="fuelTotal" step="0.01" readonly />
                </div>

                <div class="form-group">
                    <label for="fuelDate">–î–∞—Ç–∞ –∑–∞–ø—Ä–∞–≤–∫–∏ *</label>
                    <input type="datetime-local" id="fuelDate" required />
                </div>

                <div style="display:flex; gap:12px; margin-top:20px;">
                    <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" id="cancelFuelBtn" class="btn" style="background:#ccc;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- –í–∫–ª–∞–¥–∫–∞: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ -->
<div id="vehicles" class="tab-content">
    <h2>–ú–æ–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h2>
    <button class="btn" id="addVehicleBtn" style="margin-bottom: 16px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>

    <table id="vehiclesTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>–ú–∞—Ä–∫–∞</th>
            <th>–ú–æ–¥–µ–ª—å</th>
            <th>–ù–æ–º–µ—Ä</th>
            <th>–ì—Ä—É–∑–æ–ø–æ–¥—ä—ë–º–Ω–æ—Å—Ç—å (—Ç)</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr><td colspan="7">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
    </table>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="vehicleModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
        <div style="background:white; margin:50px auto; padding:24px; width:90%; max-width:600px; border-radius:12px;">
            <h3 id="vehicleModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h3>
            <form id="vehicleForm">
                <input type="hidden" id="vehicleId" />

                <div class="form-group">
                    <label for="vehicleBrand">–ú–∞—Ä–∫–∞ *</label>
                    <input type="text" id="vehicleBrand" required />
                </div>

                <div class="form-group">
                    <label for="vehicleModel">–ú–æ–¥–µ–ª—å *</label>
                    <input type="text" id="vehicleModel" required />
                </div>

                <div class="form-group">
                    <label for="vehicleLicense">–ì–æ—Å. –Ω–æ–º–µ—Ä *</label>
                    <input type="text" id="vehicleLicense" required />
                </div>

                <div class="form-group">
                    <label for="vehicleCapacity">–ì—Ä—É–∑–æ–ø–æ–¥—ä—ë–º–Ω–æ—Å—Ç—å (—Ç)</label>
                    <input type="number" id="vehicleCapacity" step="0.01" />
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="vehicleIsWorking"> –í —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
                    </label>
                </div>

                <div style="display:flex; gap:12px; margin-top:20px;">
                    <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" id="cancelVehicleBtn" class="btn" style="background:#ccc;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.electronAPI.setWindowSize(1000, 720);
    //window.electronAPI.openDevTools();

    let currentDriver = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const user = await window.electronAPI.getCurrentUser();
            if (user && user.role === 'driver') {
                currentDriver = user;
                document.getElementById('userInfo').textContent =
                    `${user.lastName} ${user.firstName} (–≤–æ–¥–∏—Ç–µ–ª—å)`;
                loadDriverRoutes();
            } else {
                alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω');
                window.location.href = '../login.html';
            }
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', err);
            alert('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
        }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤
    async function loadDriverRoutes() {
        const tbody = document.querySelector('#routesTable tbody');
        try {
            const res = await window.electronAPI.getDriverRoutes(currentDriver.id);
            if (!res.success) throw new Error(res.message);

            let routes = res.routes;
            if (routes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">–ù–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Ä–µ–π—Å–æ–≤</td></tr>';
                return;
            }
            routes = routes.map(r => {
                if(r.status === "created"){
                    r.status = '–°–æ–∑–¥–∞–Ω'
                }
                if(r.status === "in_transit"){
                    r.status = '–í –ø—É—Ç–∏'
                }
                if(r.status === "delivered"){
                    r.status = '–î–æ—Å—Ç–∞–≤–ª–µ–Ω'
                }
                if(r.status === "canceled"){
                    r.status = '–û—Ç–º–µ–Ω–µ–Ω'
                }
                return r
            })
            tbody.innerHTML = routes.map(r => {
                const start = r.startDate ? new Date(r.startDate).toLocaleString('ru-RU') : '‚Äî';
                const end = r.endDate ? new Date(r.endDate).toLocaleString('ru-RU') : '‚Äî';
                return `
            <tr>
              <td>${r.routeId}</td>
              <td>#${r.orderId}</td>
              <td>${r.departurePoint} ‚Üí ${r.destinationPoint}</td>
              <td>${r.status || '‚Äî'}</td>
              <td>${start}<br>${end}</td>
              <td>
                <button class="btn-edit-route" data-id="${r.routeId}">‚úèÔ∏è</button>
                <button class="btn-delete-route" data-id="${r.routeId}">üóëÔ∏è</button>
              </td>
            </tr>
          `;
            }).join('');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Å–æ–≤:', err);
            tbody.innerHTML = `<tr><td colspan="6">–û—à–∏–±–∫–∞: ${err.message}</td></tr>`;
        }
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è
    document.getElementById('addRouteBtn').addEventListener('click', () => {
        document.getElementById('routeModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–π—Å';
        document.getElementById('routeId').value = '';
        document.getElementById('routeForm').reset();
        document.getElementById('routeModal').style.display = 'block';
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
    document.getElementById('routeForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const routeId = document.getElementById('routeId').value;
        const data = {
            orderId: parseInt(document.getElementById('routeOrder').value),
            departurePoint: document.getElementById('routeStart').value,
            destinationPoint: document.getElementById('routeEnd').value,
            startDate: document.getElementById('routeStartDateTime').value
                ? new Date(document.getElementById('routeStartDateTime').value) : null,
            endDate: document.getElementById('routeEndDateTime').value
                ? new Date(document.getElementById('routeEndDateTime').value) : null,
            distance: parseFloat(document.getElementById('routeDistance').value) || null,
            driverId: currentDriver.id,
        };

        let res;
        if (routeId) {
            res = await window.electronAPI.updateRouteAsDriver(routeId, data);
        } else {
            res = await window.electronAPI.createRouteAsDriver(data);
        }

        if (res.success) {
            alert(routeId ? '–†–µ–π—Å –æ–±–Ω–æ–≤–ª—ë–Ω' : '–†–µ–π—Å –¥–æ–±–∞–≤–ª–µ–Ω');
            document.getElementById('routeModal').style.display = 'none';
            loadDriverRoutes();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ
    document.getElementById('routesTable').addEventListener('click', async (e) => {
        if (e.target.classList.contains('btn-edit-route')) {
            const routeId = e.target.dataset.id;
            const res = await window.electronAPI.getDriverRoutes(currentDriver.id);
            const route = res.routes.find(r => r.routeId == routeId);
            if (route) {
                document.getElementById('routeModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–π—Å';
                document.getElementById('routeId').value = route.routeId;
                document.getElementById('routeOrder').value = route.orderId;
                document.getElementById('routeStart').value = route.departurePoint;
                document.getElementById('routeEnd').value = route.destinationPoint;
                document.getElementById('routeStartDateTime').value = route.startDate
                    ? new Date(route.startDate).toISOString().slice(0, 16) : '';
                document.getElementById('routeEndDateTime').value = route.endDate
                    ? new Date(route.endDate).toISOString().slice(0, 16) : '';
                document.getElementById('routeDistance').value = route.distance || '';
                document.getElementById('routeModal').style.display = 'block';
            }
        }

        if (e.target.classList.contains('btn-delete-route')) {
            const routeId = e.target.dataset.id;
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Ä–µ–π—Å?')) {
                const res = await window.electronAPI.deleteRouteAsDriver({ routeId, driverId: currentDriver.id });
                if (res.success) {
                    alert('–†–µ–π—Å —É–¥–∞–ª—ë–Ω');
                    loadDriverRoutes();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + res.message);
                }
            }
        }
    });

    // –û—Ç–º–µ–Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.getElementById('cancelRouteBtn').addEventListener('click', () => {
        document.getElementById('routeModal').style.display = 'none';
    });

    // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        if (confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
            await window.electronAPI.logout();
            window.electronAPI.openLoginWindow();
            window.close();
        }
    });
    //---------------------------violations-----------------------------------
    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π
    async function loadViolations() {
        const tbody = document.querySelector('#violationsTable tbody');
        try {
            const res = await window.electronAPI.getDriverViolations(currentDriver.id);
            if (!res.success) throw new Error(res.message);

            const violations = res.violations;
            if (violations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7">–ù–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π</td></tr>';
                return;
            }

            tbody.innerHTML = violations.map(v => `
      <tr>
        <td>${v.violationId}</td>
        <td>–†–µ–π—Å #${v.routeId} (–ó–∞–∫–∞–∑ #${v.orderId})</td>
        <td>${v.type === 'accident' ? '–î–¢–ü' : '–®—Ç—Ä–∞—Ñ'}</td>
        <td>${v.description || '‚Äî'}</td>
        <td>${v.amount ? v.amount + ' ‚ÇΩ' : '‚Äî'}</td>
        <td>${new Date(v.occurredAt).toLocaleString('ru-RU')}</td>
        <td>
          <button class="btn-edit-violation" data-id="${v.id}">‚úèÔ∏è</button>
          <button class="btn-delete-violation" data-id="${v.id}">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π:', err);
            tbody.innerHTML = `<tr><td colspan="7">–û—à–∏–±–∫–∞: ${err.message}</td></tr>`;
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤ –≤ —Å–µ–ª–µ–∫—Ç
    async function loadRoutesForViolations() {
        const select = document.getElementById('violationRoute');
        select.innerHTML = '<option value="">‚Äî –ó–∞–≥—Ä—É–∑–∫–∞... ‚Äî</option>';

        try {
            const res = await window.electronAPI.getDriverRoutesForViolations(currentDriver.id);
            if (!res.success) throw new Error(res.message);

            select.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å ‚Äî</option>';
            res.routes.forEach(r => {
                const opt = document.createElement('option');
                opt.value = r.routeId;
                opt.textContent = `–†–µ–π—Å #${r.routeId} ‚Äî ${r.departurePoint} ‚Üí ${r.destinationPoint}`;
                select.appendChild(opt);
            });
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Å–æ–≤ –¥–ª—è –Ω–∞—Ä—É—à–µ–Ω–∏–π:', err);
            select.innerHTML = '<option value="">–û—à–∏–±–∫–∞</option>';
        }
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è
    document.getElementById('addViolationBtn').addEventListener('click', () => {
        loadRoutesForViolations();
        document.getElementById('violationModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ';
        document.getElementById('violationId').value = '';
        document.getElementById('violationForm').reset();
        document.getElementById('violationModal').style.display = 'block';
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è
    document.getElementById('violationForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const violationId = document.getElementById('violationId').value;
        const type = document.querySelector('input[name="violationType"]:checked')?.value;
        if (!type) {
            alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞—Ä—É—à–µ–Ω–∏—è');
            return;
        }

        const data = {
            routeId: parseInt(document.getElementById('violationRoute').value),
            type,
            description: document.getElementById('violationDesc').value || null,
            amount: parseFloat(document.getElementById('violationAmount').value) || null,
            occurredAt: document.getElementById('violationDate').value
                ? new Date(document.getElementById('violationDate').value) : null
        };

        if (!data.routeId) {
            alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å');
            return;
        }

        let res;
        if (violationId) {
            res = await window.electronAPI.updateViolation(violationId, data);
        } else {
            res = await window.electronAPI.createViolation(data);
        }

        if (res.success) {
            alert(violationId ? '–ù–∞—Ä—É—à–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ' : '–ù–∞—Ä—É—à–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
            document.getElementById('violationModal').style.display = 'none';
            loadViolations();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ
    document.getElementById('violationsTable').addEventListener('click', async (e) => {
        if (e.target.classList.contains('btn-edit-violation')) {
            const res = await window.electronAPI.getDriverViolations(currentDriver.id);
            const violationId = res.violations[0].violationId
            console.log(violationId)
            console.log(res.violations)
            console.log(res.violations[0].violationId)
            const violation = null//res.violations.find(v => v.violationId === violationId);
            console.log(violation);
            if (violation) {
                loadRoutesForViolations();
                document.getElementById('violationModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ';
                document.getElementById('violationId').value = violation.violationId;

                // –£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏—è
                document.getElementById('violationRoute').value = violation.routeId;
                document.querySelector(`input[name="violationType"][value="–î–¢–ü"]`).checked = true;
                document.getElementById('violationDesc').value = violation.description || '';
                document.getElementById('violationAmount').value = violation.amount || '';
                document.getElementById('violationDate').value = violation.occurredAt
                    ? new Date(violation.occurredAt).toISOString().slice(0, 16) : '';

                document.getElementById('violationModal').style.display = 'block';
            }
        }

        if (e.target.classList.contains('btn-delete-violation')) {
            const violationId = e.target.dataset.id;
            console.log("violationId: ",violationId);
            if (confirm('–£–¥–∞–ª–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏–µ?')) {
                const res = await window.electronAPI.deleteViolation(violationId);
                if (res.success) {
                    alert('–ù–∞—Ä—É—à–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
                    loadViolations();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + res.message);
                }
            }
        }
    });

    // –û—Ç–º–µ–Ω–∞
    document.getElementById('cancelViolationBtn').addEventListener('click', () => {
        document.getElementById('violationModal').style.display = 'none';
    });

    // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('[data-tab="violations"]').addEventListener('click', loadViolations);
    document.addEventListener('DOMContentLoaded', () => {
        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤–∫–ª–∞–¥–æ–∫
        const tabButtons = document.querySelectorAll('.tab-btn');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // 1. –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å 'active' —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                tabButtons.forEach(btn => btn.classList.remove('active'));

                // 2. –î–æ–±–∞–≤–ª—è–µ–º 'active' —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                button.classList.add('active');

                // 3. –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç—ã –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // 4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
                const targetTabId = button.dataset.tab;
                const targetContent = document.getElementById(targetTabId);
                if (targetContent) {
                    targetContent.classList.add('active');

                    // 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                    if (targetTabId === 'violations' && typeof loadViolations === 'function') {
                        loadViolations();
                    }
                    if (targetTabId === 'my-routes' && typeof loadDriverRoutes === 'function') {
                        loadDriverRoutes();
                    }
                }
            });
        });
    });
//----------fuel-----------------
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    function updateFuelTotal() {
        const volume = parseFloat(document.getElementById('fuelVolume').value) || 0;
        const price = parseFloat(document.getElementById('fuelPrice').value) || 0;
        document.getElementById('fuelTotal').value = (volume * price).toFixed(2);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—Ä–∞–≤–æ–∫
    async function loadFuel() {
        const tbody = document.querySelector('#fuelTable tbody');
        try {
            const res = await window.electronAPI.getDriverFuel(currentDriver.id);
            if (!res.success) throw new Error(res.message);

            const fuelList = res.fuel;
            if (fuelList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8">–ù–µ—Ç –∑–∞–ø—Ä–∞–≤–æ–∫</td></tr>';
                return;
            }

            tbody.innerHTML = fuelList.map(f => `
      <tr>
        <td>${f.fuelId}</td>
        <td>–†–µ–π—Å #${f.routeId} (–ó–∞–∫–∞–∑ #${f.orderId})</td>
        <td>${f.fuelType}</td>
        <td>${f.volume} –ª</td>
        <td>${f.pricePerLiter} ‚ÇΩ</td>
        <td>${f.totalCost} ‚ÇΩ</td>
        <td>${new Date(f.refuelDate).toLocaleString('ru-RU')}</td>
        <td>
          <button class="btn-edit-fuel" data-id="${f.fuelId}">‚úèÔ∏è</button>
          <button class="btn-delete-fuel" data-id="${f.fuelId}">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–∞–≤–æ–∫:', err);
            tbody.innerHTML = `<tr><td colspan="8">–û—à–∏–±–∫–∞: ${err.message}</td></tr>`;
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Å–æ–≤ –≤ —Å–µ–ª–µ–∫—Ç
    async function loadRoutesForFuel() {
        const select = document.getElementById('fuelRoute');
        select.innerHTML = '<option value="">‚Äî –ó–∞–≥—Ä—É–∑–∫–∞... ‚Äî</option>';

        try {
            const res = await window.electronAPI.getDriverRoutesForFuel(currentDriver.id);
            if (!res.success) throw new Error(res.message);

            select.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–π—Å ‚Äî</option>';
            res.routes.forEach(r => {
                const opt = document.createElement('option');
                opt.value = r.routeId;
                opt.textContent = `–†–µ–π—Å #${r.routeId} ‚Äî ${r.departurePoint} ‚Üí ${r.destinationPoint}`;
                select.appendChild(opt);
            });
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Å–æ–≤ –¥–ª—è —Ç–æ–ø–ª–∏–≤–∞:', err);
            select.innerHTML = '<option value="">–û—à–∏–±–∫–∞</option>';
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
    async function loadVehicles() {
        const tbody = document.querySelector('#vehiclesTable tbody');
        try {
            const res = await window.electronAPI.getAllVehicles();
            if (!res.success) throw new Error(res.message);

            const vehicles = res.vehicles;
            if (vehicles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7">–ù–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤</td></tr>';
                return;
            }

            tbody.innerHTML = vehicles.map(v => `
      <tr>
        <td>${v.vehicleId}</td>
        <td>${v.brand}</td>
        <td>${v.model}</td>
        <td>${v.licensePlate}</td>
        <td>${v.capacity || '‚Äî'}</td>
        <td>
          <span style="color: ${v.isWorking ? 'green' : 'red'};">
            ${v.isWorking ? '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç'}
          </span>
        </td>
        <td>
          <button class="btn-edit-vehicle" data-id="${v.id}">‚úèÔ∏è</button>
          <button class="btn-delete-vehicle" data-id="${v.id}">üóëÔ∏è</button>
        </td>
      </tr>
    `).join('');
        } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞:', err);
            tbody.innerHTML = `<tr><td colspan="7">–û—à–∏–±–∫–∞: ${err.message}</td></tr>`;
        }
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è
    document.getElementById('addVehicleBtn').addEventListener('click', () => {
        document.getElementById('vehicleModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç';
        document.getElementById('vehicleId').value = '';
        document.getElementById('vehicleForm').reset();
        document.getElementById('vehicleIsWorking').checked = true;
        document.getElementById('vehicleModal').style.display = 'block';
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    document.getElementById('vehicleForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const vehicleId = document.getElementById('vehicleId').value;
        const data = {
            brand: document.getElementById('vehicleBrand').value,
            model: document.getElementById('vehicleModel').value,
            licensePlate: document.getElementById('vehicleLicense').value,
            capacity: parseFloat(document.getElementById('vehicleCapacity').value) || null,
            isWorking: document.getElementById('vehicleIsWorking').checked
        };

        if (!data.brand || !data.model || !data.licensePlate) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
            return;
        }

        let res;
        if (vehicleId) {
            res = await window.electronAPI.updateVehicle(16, data);
        } else {
            res = await window.electronAPI.createVehicle(data);
        }

        if (res.success) {
            alert(vehicleId ? '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –æ–±–Ω–æ–≤–ª—ë–Ω' : '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
            document.getElementById('vehicleModal').style.display = 'none';
            loadVehicles();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ
    document.getElementById('vehiclesTable').addEventListener('click', async (e) => {
        console.log('hello 2')
        if (e.target.classList.contains('btn-edit-vehicle')) {
            const res = await window.electronAPI.getAllVehicles();
            const vehicleId = e.target.dataset.id ?? res.vehicles[0].vehicleId
            const vehicle = res.vehicles[0]//res.vehicles.find(v => v.vehicleId === vehicleId);
            if (vehicle) {
                document.getElementById('vehicleModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç';
                document.getElementById('vehicleId').value = vehicle.id;
                document.getElementById('vehicleBrand').value = vehicle.brand;
                document.getElementById('vehicleModel').value = vehicle.model;
                document.getElementById('vehicleLicense').value = vehicle.licensePlate;
                document.getElementById('vehicleCapacity').value = vehicle.capacity || '';
                document.getElementById('vehicleIsWorking').checked = vehicle.isWorking;
                document.getElementById('vehicleModal').style.display = 'block';
            }
        }

        if (e.target.classList.contains('btn-delete-vehicle')) {
            const vehicleId = e.target.dataset.id;
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç?')) {
                const res = await window.electronAPI.deleteVehicle(vehicleId);
                if (res.success) {
                    alert('–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —É–¥–∞–ª—ë–Ω');
                    loadVehicles();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + res.message);
                }
            }
        }
    });

    // –û—Ç–º–µ–Ω–∞
    document.getElementById('cancelVehicleBtn').addEventListener('click', () => {
        document.getElementById('vehicleModal').style.display = 'none';
    });

    // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('[data-tab="vehicles"]').addEventListener('click', loadVehicles);

    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è
    document.getElementById('addFuelBtn').addEventListener('click', () => {
        loadRoutesForFuel();
        document.getElementById('fuelModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É';
        document.getElementById('fuelId').value = '';
        document.getElementById('fuelForm').reset();
        document.getElementById('fuelTotal').value = '';
        document.getElementById('fuelModal').style.display = 'block';
    });

    // –ê–≤—Ç–æ–ø–µ—Ä–µ—Å—á—ë—Ç –∏—Ç–æ–≥–∞
    document.getElementById('fuelVolume')?.addEventListener('input', updateFuelTotal);
    document.getElementById('fuelPrice')?.addEventListener('input', updateFuelTotal);

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    document.getElementById('fuelForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const fuelId = document.getElementById('fuelId').value;
        const data = {
            routeId: parseInt(document.getElementById('fuelRoute').value),
            fuelType: document.getElementById('fuelType').value,
            volume: parseFloat(document.getElementById('fuelVolume').value),
            pricePerLiter: parseFloat(document.getElementById('fuelPrice').value),
            totalCost: parseFloat(document.getElementById('fuelTotal').value),
            refuelDate: new Date(document.getElementById('fuelDate').value)
        };

        if (!data.routeId || !data.fuelType || !data.volume || !data.pricePerLiter || !data.refuelDate) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
            return;
        }

        let res;
        if (fuelId) {
            res = await window.electronAPI.updateFuel(fuelId, data);
        } else {
            res = await window.electronAPI.createFuel(data);
        }

        if (res.success) {
            alert(fuelId ? '–ó–∞–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–ó–∞–ø—Ä–∞–≤–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
            document.getElementById('fuelModal').style.display = 'none';
            loadFuel();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + res.message);
        }
    });

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ
    document.getElementById('fuelTable').addEventListener('click', async (e) => {
        if (e.target.classList.contains('btn-edit-fuel')) {
            const fuelId = e.target.dataset.id;
            const res = await window.electronAPI.getDriverFuel(currentDriver.id);
            const fuel = res.fuel.find(f => f.fuelId == fuelId);
            if (fuel) {
                loadRoutesForFuel();
                document.getElementById('fuelModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É';
                document.getElementById('fuelId').value = fuel.fuelId;
                document.getElementById('fuelRoute').value = fuel.routeId;
                document.getElementById('fuelType').value = fuel.fuelType;
                document.getElementById('fuelVolume').value = fuel.volume;
                document.getElementById('fuelPrice').value = fuel.pricePerLiter;
                document.getElementById('fuelTotal').value = fuel.totalCost;
                document.getElementById('fuelDate').value = new Date(fuel.refuelDate).toISOString().slice(0, 16);
                document.getElementById('fuelModal').style.display = 'block';
            }
        }

        if (e.target.classList.contains('btn-delete-fuel')) {
            const fuelId = e.target.dataset.id;
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø—Ä–∞–≤–∫—É?')) {
                const res = await window.electronAPI.deleteFuel(fuelId);
                if (res.success) {
                    alert('–ó–∞–ø—Ä–∞–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
                    loadFuel();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + res.message);
                }
            }
        }
    });

    // –û—Ç–º–µ–Ω–∞
    document.getElementById('cancelFuelBtn').addEventListener('click', () => {
        document.getElementById('fuelModal').style.display = 'none';
    });

    // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('[data-tab="fuel"]').addEventListener('click', loadFuel);
</script>
</body>
</html>